<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CAP-402 SDK Reference</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --arcium-purple: #6C44FC;
      --bg-dark: #0a0a0c;
      --bg-card: rgba(255,255,255,0.03);
      --border-subtle: rgba(255,255,255,0.08);
      --text-primary: #fafafa;
      --text-secondary: #888;
      --green: #22c55e;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
    .topbar { background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%); padding: 1rem 2rem; border-bottom: 1px solid var(--border-subtle); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
    .topbar-left { display: flex; align-items: center; gap: 0.75rem; }
    .topbar-left img { height: 28px; }
    .topbar-left h1 { font-size: 1rem; color: var(--text-primary); }
    .nav-links { display: flex; gap: 0.5rem; }
    .nav-links a { padding: 0.4rem 0.8rem; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 6px; font-size: 0.8rem; color: var(--text-secondary); text-decoration: none; transition: all 0.2s; }
    .nav-links a:hover { background: rgba(108, 68, 252, 0.15); border-color: var(--arcium-purple); color: var(--text-primary); }
    .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
    h1 { font-size: 2rem; margin-bottom: 0.5rem; }
    h2 { font-size: 1.25rem; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-subtle); color: var(--text-primary); }
    h3 { font-size: 1rem; margin: 1.5rem 0 0.75rem; color: var(--arcium-purple); }
    p { color: var(--text-secondary); margin-bottom: 1rem; }
    .code-block { background: #111; border: 1px solid var(--border-subtle); border-radius: 6px; padding: 1rem; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--green); overflow-x: auto; margin: 1rem 0; white-space: pre; }
    table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    th, td { border: 1px solid var(--border-subtle); padding: 0.5rem 1rem; text-align: left; }
    th { background: var(--bg-card); color: var(--text-primary); }
    td { color: var(--text-secondary); }
    ul { margin: 1rem 0; padding-left: 1.5rem; color: var(--text-secondary); }
    li { margin-bottom: 0.5rem; }
    strong { color: var(--text-primary); }

    /* CAP-402 Brand Icons */
    .cap-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 5px;
      background: linear-gradient(135deg, rgba(108,68,252,0.15) 0%, rgba(108,68,252,0.05) 100%);
      border: 1px solid rgba(108,68,252,0.3);
      position: relative;
      flex-shrink: 0;
      vertical-align: middle;
      margin-right: 0.5rem;
    }
    .cap-icon::before {
      content: '';
      position: absolute;
    }
    .cap-icon.icon-a2a::before {
      width: 5px;
      height: 5px;
      background: var(--arcium-purple);
      border-radius: 50%;
      box-shadow: 7px 0 0 var(--arcium-purple);
    }
    .cap-icon.icon-a2a::after {
      content: '';
      position: absolute;
      width: 7px;
      height: 2px;
      background: rgba(108,68,252,0.6);
    }
    .cap-icon.icon-lock::before {
      width: 8px;
      height: 6px;
      background: var(--arcium-purple);
      border-radius: 2px;
      margin-top: 2px;
    }
    .cap-icon.icon-lock::after {
      content: '';
      position: absolute;
      width: 5px;
      height: 4px;
      border: 2px solid var(--arcium-purple);
      border-bottom: none;
      border-radius: 5px 5px 0 0;
      top: 5px;
    }
    .cap-icon.icon-bolt::before {
      width: 0;
      height: 0;
      border-left: 3px solid transparent;
      border-right: 3px solid transparent;
      border-bottom: 6px solid var(--arcium-purple);
      margin-top: -3px;
    }
    .cap-icon.icon-bolt::after {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
      border-left: 3px solid transparent;
      border-right: 3px solid transparent;
      border-top: 6px solid var(--arcium-purple);
      margin-top: 3px;
      margin-left: -1px;
    }
    .cap-icon.icon-chart::before {
      width: 3px;
      height: 7px;
      background: var(--arcium-purple);
      box-shadow: 4px 2px 0 0 var(--arcium-purple), -4px 3px 0 0 var(--arcium-purple);
    }
    .cap-icon.icon-globe::before {
      width: 10px;
      height: 10px;
      border: 2px solid var(--arcium-purple);
      border-radius: 50%;
    }
    .cap-icon.icon-doc::before {
      width: 8px;
      height: 10px;
      border: 2px solid var(--arcium-purple);
      border-radius: 2px;
    }
    .cap-icon.icon-green {
      background: linear-gradient(135deg, rgba(34,197,94,0.15) 0%, rgba(34,197,94,0.05) 100%);
      border-color: rgba(34,197,94,0.3);
    }
    .cap-icon.icon-green::before,
    .cap-icon.icon-green::after {
      background-color: #22c55e;
      border-color: #22c55e;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-left">
      <a href="/"><img src="/public/CAP402logo.png" alt="CAP-402"></a>
      <h1>SDK Reference</h1>
    </div>
    <div class="nav-links">
      <a href="/docs">Docs</a>
      <a href="/docs/api-docs.html">API</a>
      <a href="/docs/whitepaper.html">Whitepaper</a>
      <a href="/">Home</a>
      <a href="https://github.com/TheQuantumChronicle/CAP402" target="_blank">GitHub</a>
    </div>
  </div>
  
  <div class="container">
    <h1>Agent SDK Reference</h1>
    <p>Build fully autonomous agents that monitor markets, analyze risk, and prepare ready-to-sign transactions. You retain full control—just sign in your wallet.</p>
    
    <h2>Quick Start</h2>
    <pre class="code-block">import { cap402 } from '@cap402/sdk';

// One-liner operations
const price = await cap402.price('SOL');           // $143.34
const wallet = await cap402.wallet('address...');
const swap = await cap402.swap('SOL', 'USDC', 10); // dry_run by default</pre>
    
    <h2>Agent Templates</h2>
    <h3>Trading Agent</h3>
    <p>Monitors prices, generates signals, and prepares ready-to-sign swap transactions.</p>
    <pre class="code-block">import { createTradingAgent } from '@cap402/sdk';

const trader = createTradingAgent({
  agent_id: 'sol-trader',
  watched_tokens: ['SOL', 'ETH', 'BTC'],
  mev_protection: true
});

// Agent prepares transactions autonomously
trader.on('signal', async (signal) => {
  const tx = await trader.actOnSignal(signal, 10);
  // tx is ready for your wallet to sign
});

await trader.start();</pre>
    
    <h3>Prepared Transactions</h3>
    <p>Agents return ready-to-sign transactions with all details calculated:</p>
    <pre class="code-block">const prepared = await trader.prepareSwap('SOL', 'USDC', 10);

// Returns:
{
  instruction_id: 'prep_1705412400_abc123',
  type: 'swap',
  status: 'ready',
  expires_at: 1705412460000,
  
  token_in: 'SOL',
  token_out: 'USDC',
  amount_in: 10,
  expected_out: 1433.40,
  min_out: 1426.23,
  slippage_bps: 50,
  
  dex: 'jupiter',
  mev_risk: 'LOW',
  
  user_action_required: 'sign_and_submit',
  instructions_for_user: 'Swap 10 SOL for ~1433.40 USDC. Sign in wallet.'
}</pre>
    
    <h3>Monitoring Agent</h3>
    <p>Tracks wallet balances and protocol health, triggers alerts.</p>
    <pre class="code-block">import { createMonitoringAgent } from '@cap402/sdk';

const monitor = createMonitoringAgent({
  agent_id: 'wallet-monitor',
  watched_wallets: ['YOUR_WALLET_ADDRESS'],
  check_interval_ms: 60000,
  alert_channels: [{ type: 'console', enabled: true }]
});

monitor.on('alert', (alert) => {
  console.log(\`\${alert.severity}: \${alert.title}\`);
});

await monitor.start();</pre>
    
    <h3>Analytics Agent</h3>
    <p>Collects time-series data, generates reports and insights.</p>
    <pre class="code-block">import { createAnalyticsAgent } from '@cap402/sdk';

const analytics = createAnalyticsAgent({
  agent_id: 'market-analytics',
  data_sources: [{
    id: 'sol-price',
    type: 'price',
    capability_id: 'cap.price.lookup.v1',
    inputs: { base_token: 'SOL' },
    interval_ms: 60000,
    enabled: true
  }]
});

analytics.on('report_generated', (report) => {
  console.log('Insights:', report.insights);
});

await analytics.start();</pre>
    
    <h2>Safety Guardrails</h2>
    <p>Built-in protection with sensible defaults:</p>
    <table>
      <tr><th>Limit</th><th>Default</th><th>Description</th></tr>
      <tr><td>Per Transaction</td><td>$100</td><td>Maximum USD per single transaction</td></tr>
      <tr><td>Per Hour</td><td>$500</td><td>Maximum USD spending per hour</td></tr>
      <tr><td>Per Day</td><td>$2,000</td><td>Maximum USD spending per day</td></tr>
      <tr><td>Trades/Hour</td><td>20</td><td>Maximum trades per hour</td></tr>
      <tr><td>Invocations/Min</td><td>60</td><td>Rate limit per minute</td></tr>
    </table>
    <pre class="code-block">import { createSafetyGuardrails, SAFETY_PRESETS } from '@cap402/sdk';

// Use presets: conservative, standard, aggressive
const safety = createSafetyGuardrails(SAFETY_PRESETS.conservative);

// Or customize
const custom = createSafetyGuardrails({
  spending_limits: {
    max_per_transaction: 50,
    max_per_hour: 200
  },
  blocked_tokens: ['SCAM_TOKEN']
});</pre>
    
    <h2>One-Liner Convenience Methods</h2>
    <p>Simple methods for common operations:</p>
    <pre class="code-block">// Buy token (prepares transaction for signing)
const buyTx = await trader.buy('SOL', 100); // Buy $100 worth of SOL

// Sell token
const sellTx = await trader.sell('SOL', 10); // Sell 10 SOL

// Smart swap - auto-selects best route (DEX vs A2A)
const result = await trader.smartSwap('SOL', 'USDC', 100);
console.log(result.execution_summary);
// "A2A trade via agent-xyz: 100 SOL → 14,334 USDC (0.5% better than DEX)"

// Check if trade is profitable
const check = await trader.isProfitable('SOL', 'USDC', 1000);
console.log(check.recommendation);

// Get portfolio value
const portfolio = await trader.getPortfolioValue();
console.log(\`Total: $\${portfolio.total_usd}\`);</pre>

    <h2>Agent-to-Agent (A2A) Trading</h2>
    <p>Trade directly with other agents for better prices and liquidity:</p>
    <pre class="code-block">// Find trading partners with quotes
const partners = await trader.findTradingPartners('SOL', 'USDC', 100);
console.log(\`Found \${partners.length} partners\`);
console.log(\`Best offer: \${partners[0].quote.amount_out} USDC\`);

// Execute A2A trade
const result = await trader.executeA2ATrade(partners[0].quote);
if (result.status === 'executed') {
  console.log(\`Received: \${result.amount_received} USDC\`);
}

// Auction - agents compete for best price
const auction = await trader.auctionTrade('SOL', 'USDC', 1000);
console.log(\`Winner: \${auction.winner?.agent_id} at \${auction.best_price}\`);

// Swarm trade - split large orders across agents
const swarm = await trader.swarmTrade('SOL', 'USDC', 10000, { minAgents: 3 });
console.log(\`Executed via \${swarm.participants.length} agents\`);
console.log(\`Total received: \${swarm.total_amount_out} USDC\`);</pre>

    <h3>Signal Sharing</h3>
    <pre class="code-block">// Broadcast signals to other agents
await trader.broadcastSignal(alphaSignal);

// Receive signals from other agents
trader.on('a2a_signal', ({ from, signal }) => {
  console.log(\`Signal from \${from}: \${signal.type} \${signal.token}\`);
});

// Poll for signals
const signals = await trader.pollA2ASignals();</pre>

    <h2>Alpha Detection</h2>
    <p>Detect trading opportunities with momentum and reversal signals:</p>
    <pre class="code-block">// Detect alpha signals
const alphaSignals = await trader.detectAlpha();

for (const signal of alphaSignals) {
  console.log(\`\${signal.type}: \${signal.token} \${signal.direction}\`);
  console.log(\`  Action: \${signal.suggested_action}\`);
  console.log(\`  Entry: $\${signal.entry_price}\`);
  console.log(\`  Target: $\${signal.target_price}\`);
  console.log(\`  Stop: $\${signal.stop_loss}\`);
  console.log(\`  Confidence: \${signal.confidence}%\`);
}

// Listen for alpha events
trader.on('alpha', (signal) => {
  if (signal.confidence > 70) {
    const tx = await trader.actOnSignal(signal);
    // Ready-to-sign transaction
  }
});</pre>

    <h2>Multi-Agent Orchestration</h2>
    <pre class="code-block">import { createOrchestrator } from '@cap402/sdk';

const orchestrator = createOrchestrator({
  orchestrator_id: 'trading-swarm',
  max_agents: 5
});

// Parallel execution
const results = await orchestrator.executeParallel([
  { capability_id: 'cap.price.lookup.v1', inputs: { base_token: 'SOL' } },
  { capability_id: 'cap.price.lookup.v1', inputs: { base_token: 'ETH' } }
]);

// Consensus execution
const consensus = await orchestrator.executeWithConsensus(
  'cap.price.lookup.v1',
  { base_token: 'SOL' },
  { min_agreement: 0.5 }
);</pre>
    
    <h2>Secure A2A Communication</h2>
    <p>Encrypted messaging with privacy levels and cryptographic verification:</p>
    <pre class="code-block">// Establish secure channel with another agent
const session = await trader.establishSecureChannel('agent-xyz', 'confidential');
// { session_id, status: 'established', privacy_level: 'confidential' }

// Send encrypted message
const msg = await trader.sendSecureMessage('agent-xyz', {
  type: 'trade_proposal',
  token: 'SOL',
  amount: 100
}, 'confidential');

// Verify received message
const verification = await trader.verifyMessage(incomingMessage);
if (verification.valid) {
  console.log('Verified payload:', verification.decrypted_payload);
}

// Close secure channel
await trader.closeSecureChannel('agent-xyz');</pre>

    <h3>Privacy Levels</h3>
    <table>
      <tr><th>Level</th><th>Description</th><th>Use Case</th></tr>
      <tr><td>public</td><td>No encryption, signed only</td><td>Broadcast signals</td></tr>
      <tr><td>confidential</td><td>Encrypted in transit</td><td>Trade negotiations</td></tr>
      <tr><td>private</td><td>Zero-knowledge proofs</td><td>Sensitive strategies</td></tr>
      <tr><td>maximum</td><td>Full MPC/FHE</td><td>High-value trades</td></tr>
    </table>

    <h2>Fault Tolerance</h2>
    <p>Built-in retry logic, circuit breakers, and fallback agents:</p>
    <pre class="code-block">// Configure fault tolerance
trader.setFaultConfig({
  max_retries: 3,
  retry_delay_ms: 1000,
  timeout_ms: 30000,
  fallback_agents: ['agent-backup-1', 'agent-backup-2'],
  circuit_breaker_threshold: 5
});

// Execute with automatic retries and fallbacks
const result = await trader.executeWithFaultTolerance(
  () => trader.requestQuote('agent-xyz', 'SOL', 'USDC', 100),
  'agent-xyz',
  ['agent-backup']
);

if (result.success) {
  console.log(\`Completed in \${result.attempts} attempts\`);
  if (result.used_fallback) {
    console.log(\`Used fallback: \${result.used_fallback}\`);
  }
}</pre>

    <h2>Cross-Protocol Interoperability</h2>
    <p>Communicate with agents on other protocols (Google A2A, MCP, custom):</p>
    <pre class="code-block">// Register a cross-protocol agent
trader.registerCrossProtocolAgent({
  agent_id: 'google-agent-1',
  protocol: 'a2a_google',
  endpoint: 'https://agent.example.com',
  capabilities: ['swap', 'quote']
});

// Invoke capability on cross-protocol agent
const result = await trader.invokeCrossProtocol(
  'google-agent-1',
  'swap',
  { token_in: 'SOL', token_out: 'USDC', amount: 100 }
);

// Discover agents across all protocols
const agents = await trader.discoverCrossProtocolAgents({
  protocols: ['cap402', 'a2a_google', 'mcp'],
  capability: 'swap'
});</pre>

    <h2>CLI Tools</h2>
    <pre class="code-block"># Health check
npm run cli health

# List capabilities
npm run cli capabilities

# Invoke a capability
npm run cli invoke cap.price.lookup.v1 '{"base_token":"SOL"}'

# Run examples
npm run example:trading
npm run example:monitor</pre>
    
    <h2>Zero-Config One-Liners</h2>
    <p>No setup required for common operations:</p>
    <pre class="code-block">import { prepareSwap, bestSwap, findAlpha, findPartners, autoTrader } from '@cap402/sdk';

// Prepare swap without agent setup
const tx = await prepareSwap('SOL', 'USDC', 10);
console.log(tx.summary.headline); // "Swap 10 SOL → ~1,433 USDC"

// Get best execution route (DEX vs A2A)
const result = await bestSwap('SOL', 'USDC', 100);
console.log(result.route, result.execution_summary);

// Detect alpha signals
const signals = await findAlpha(['SOL', 'ETH', 'BTC']);
signals.forEach(s => console.log(s.token, s.direction));

// Find A2A trading partners
const partners = await findPartners('SOL', 'USDC', 100);

// Auto-starting agent with event handlers
const agent = await autoTrader(['SOL', 'ETH'], {
  onSignal: console.log,
  onAlpha: console.log
});</pre>

    <h2>Error Handling</h2>
    <p>Actionable errors with suggestions and documentation links:</p>
    <pre class="code-block">import { CAP402Error, wrapError, isRetryable, getRetryDelay } from '@cap402/sdk';

try {
  await trader.prepareSwap('SOL', 'USDC', 1000000);
} catch (error) {
  if (error instanceof CAP402Error) {
    console.log(error.code);       // 'SPENDING_LIMIT_EXCEEDED'
    console.log(error.suggestion); // 'Adjust limits or use emergencyStop()'
    console.log(error.docs_url);   // 'https://cap402.com/docs/...'
  }
  
  // Check if retryable
  if (isRetryable(error)) {
    const delay = getRetryDelay(error, attempt);
    await sleep(delay);
    // Retry...
  }
}</pre>

    <h3>Error Types</h3>
    <table>
      <tr><th>Error</th><th>Code</th><th>When</th></tr>
      <tr><td>NetworkError</td><td>NETWORK_ERROR</td><td>Connection issues</td></tr>
      <tr><td>TimeoutError</td><td>TIMEOUT_ERROR</td><td>Operation timed out</td></tr>
      <tr><td>RateLimitError</td><td>RATE_LIMIT_ERROR</td><td>Too many requests</td></tr>
      <tr><td>SlippageExceededError</td><td>SLIPPAGE_EXCEEDED</td><td>Price moved too much</td></tr>
      <tr><td>MEVRiskError</td><td>MEV_RISK_HIGH</td><td>High MEV risk detected</td></tr>
      <tr><td>QuoteExpiredError</td><td>QUOTE_EXPIRED</td><td>A2A quote expired</td></tr>
      <tr><td>SpendingLimitError</td><td>SPENDING_LIMIT_EXCEEDED</td><td>Safety limit hit</td></tr>
    </table>

    <h2>Logging & Debugging</h2>
    <pre class="code-block">import { createLogger, setLogLevel } from '@cap402/sdk';

// Create agent-specific logger
const log = createLogger('my-trader', 'debug');

// Log with categories
log.info('trade', 'Preparing swap', { token: 'SOL', amount: 10 });
log.warn('mev', 'High risk detected', { risk: 'HIGH' });

// Specialized logging
log.trade('execute', { token_in: 'SOL', token_out: 'USDC', amount: 10 });
log.a2a('quote_received', { from_agent: 'agent-xyz', price: 143.34 });
log.signal('buy', 'SOL', { confidence: 85 });


